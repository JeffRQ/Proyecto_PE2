{% extends "base.html" %}
{% block title %}Inventario · {{ brand.name }}{% endblock %}
{% block content %}
<section class="section">
  <div class="section__head">
    <h1>Inventario</h1>
    <a class="btn" href="{{ url_for('productos_nuevo') }}">+ Nuevo producto</a>
  </div>

  <form method="get" class="search">
    <input type="text" name="q" placeholder="Buscar por nombre..." value="{{ q or '' }}">
    <button class="btn" type="submit">Buscar</button>
  </form>

  {% if productos %}
  <div class="table">
    <div class="row row--head">
      <div>ID</div><div>Nombre</div><div>Cantidad</div><div>Precio</div><div>Total</div><div>Acciones</div>
    </div>
    {% for p in productos %}
    <div class="row">
      <div>{{ p.id }}</div>
      <div>{{ p.nombre }}</div>
      <div>{{ p.cantidad }}</div>
      <div>${{ '%.2f'|format(p.precio) }}</div>
      <div>${{ '%.2f'|format(p.cantidad * p.precio) }}</div>
      <div class="actions">
        <a class="btn btn--sm" href="{{ url_for('productos_editar', pid=p.id) }}">Editar</a>
        <form method="post" action="{{ url_for('productos_eliminar', pid=p.id) }}" onsubmit="return confirm('¿Eliminar {{ p.nombre }}?');">
          {{ csrf_token() if csrf_token else '' }}
          <button class="btn btn--sm btn--danger" type="submit">Eliminar</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p>No hay productos… agrega el primero.</p>
  {% endif %}

  <div class="summary">
    <strong>Valor total del stock:</strong> ${{ '%.2f'|format(total_valor) }}
  </div>
</section>
{% endblock %}
